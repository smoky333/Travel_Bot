from aiogram import Router, F       # F - —ç—Ç–æ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
from aiogram.filters import Command
from aiogram.types import Message, ReplyKeyboardRemove # ReplyKeyboardRemove - —á—Ç–æ–±—ã —É–±–∏—Ä–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
from aiogram.fsm.context import FSMContext           # FSMContext - —ç—Ç–æ "–ø–∞–º—è—Ç—å" –±–æ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

from handlers.trip_planning_states import TripPlanning # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

# –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–≥–∏–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏
trip_planning_router = Router(name="trip_planning_router")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /plan_trip
@trip_planning_router.message(Command("plan_trip"))
async def cmd_plan_trip(message: Message, state: FSMContext):
    await message.answer(
        "–û—Ç–ª–∏—á–Ω–æ! –ù–∞—á–Ω–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –∏–¥–µ–∞–ª—å–Ω–æ–π –ø–æ–µ–∑–¥–∫–∏. ‚ú®\n\n"
        "<b>–®–∞–≥ 1: –ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</b>\n"
        "üìç –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–ª–∏ —Å—Ç—Ä–∞–Ω—É, –∫—É–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–µ—Ö–∞—Ç—å. "
        "–ò–ª–∏, –µ—Å–ª–∏ –≤—ã —É–∂–µ —Ç–∞–º, –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–æ—é —Ç–µ–∫—É—â—É—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é (–Ω–∞–∂–∞–≤ –Ω–∞ —Å–∫—Ä–µ–ø–∫—É üìé –∏ –≤—ã–±—Ä–∞–≤ '–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è').",
        reply_markup=ReplyKeyboardRemove() # –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—ã—á–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–µ—Å–ª–∏ –±—ã–ª–∏)
    )
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–æ–∂–∏–¥–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏"
    await state.set_state(TripPlanning.waiting_for_location)
    print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –Ω–∞—á–∞–ª –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ waiting_for_location.")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –ª–æ–∫–∞—Ü–∏–∏
# –û–Ω —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ waiting_for_location
@trip_planning_router.message(TripPlanning.waiting_for_location, F.text) # F.text - –∑–Ω–∞—á–∏—Ç, –∂–¥–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
async def process_location(message: Message, state: FSMContext):
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–≤–µ–¥–µ–Ω–Ω—É—é –ª–æ–∫–∞—Ü–∏—é –≤ "–ø–∞–º—è—Ç—å" FSM –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # message.text - —ç—Ç–æ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–∏—Å–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    await state.update_data(user_location_text=message.text)

    # –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤—ã–≤–µ–¥–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏—è)
    user_data = await state.get_data()
    print(f"–î–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id} –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ª–æ–∫–∞—Ü–∏–∏: {user_data}")

    # –ó–∞–¥–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (–ø–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ—Ç —à–∞–≥ –ø—Ä–æ–ø—É—Å—Ç–∏–º)
    # TODO: –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ waiting_for_interests
    await message.answer(
        f"–ü—Ä–∏–Ω—è—Ç–æ! –í—ã —É–∫–∞–∑–∞–ª–∏: {message.text}.\n\n"
        "<b>–®–∞–≥ 2: –í–∞—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã</b> (—ç—Ç–æ—Ç —à–∞–≥ –º—ã –ø–æ–∫–∞ –ø—Ä–æ–ø—É—Å—Ç–∏–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –Ω–æ —Å–∫–æ—Ä–æ –¥–æ–±–∞–≤–∏–º!)\n\n"
        "–°–ø–∞—Å–∏–±–æ! –ù–∞ —ç—Ç–æ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞ –∑–∞–∫–æ–Ω—á–µ–Ω (–≤—Ä–µ–º–µ–Ω–Ω–æ)."
    )
    # TODO: –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—é
    await state.clear() # –ü–æ–∫–∞ —á—Ç–æ –æ—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∫–æ–Ω–µ—Ü (–≤—Ä–µ–º–µ–Ω–Ω—ã–π)
    print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.from_user.id} –∑–∞–≤–µ—Ä—à–∏–ª (–≤—Ä–µ–º–µ–Ω–Ω–æ) –≤–≤–æ–¥. –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—â–µ–Ω–æ.")

# TODO: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (message: ContentType.LOCATION) –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ waiting_for_location